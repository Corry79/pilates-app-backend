<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Clienti Pilates</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Gestione Clienti Pilates</h1>

    <!-- Form per aggiungere un nuovo cliente -->
    <div>
        <h2>Aggiungi Cliente</h2>

        <label for="name">Nome: </label>
        <input type="text" id="name" required><br>

        <label for="email">Email: </label>
        <input type="email" id="email" required><br>

        <label for="cert-expiry">Scadenza Certificato Medico:</label>
<input type="date" id="cert-expiry" required><br>


        <button id="add-client-button" onclick="addClient()">Aggiungi Cliente</button>
    </div>

    <!-- Barra di ricerca per filtrare i clienti -->
    <div id="search-container">
        <input type="text" id="search-input" placeholder="Cerca cliente per nome o email">
        <button id="search-button">üîç</button>
    </div>

    <!-- Riquadro per visualizzare il codice RFID scansionato -->
    <div id="rfid-scan-display" style="border: 2px solid #000000; padding: 10px; margin-bottom: 10px; width: 300px; border-radius: 10px;">
        <h3>Codice RFID Scansionato</h3>
        <p id="scanned-rfid" style="font-size: 18px; font-weight: bold;">Nessun badge scansionato</p>
        <!-- Pulsante per associare il badge RFID scansionato -->
        <button id="associate-rfid-button" onclick="associateScannedRFID()" style="margin-top: 10px;">Associa Badge Scansionato</button>
    </div>

    <!-- Modulo per aggiungere/rimuovere crediti -->
    <div id="credit-form" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 1px solid #ccc; padding: 20px; background-color: #fff; z-index: 1000;">
        <h3 id="credit-form-title">Gestione Crediti</h3>
        <label for="credit-amount">Quantit√† crediti:</label>
        <input type="number" id="credit-amount" placeholder="Inserisci la quantit√† di crediti" required>
        <h4>REFORMER</h4>
        <button class="add-credit-button" id="add-credit-reformer">‚ûï Aggiungi Crediti</button>
        <button class="remove-credit-button" id="remove-credit-reformer">‚ûñ Rimuovi Crediti</button>
        <h4>MAT</h4>
        <button class="add-credit-button" id="add-credit-mat">‚ûï Aggiungi Crediti</button>
        <button class="remove-credit-button" id="remove-credit-mat">‚ûñ Rimuovi Crediti</button>
        <h4>PSM</h4>
        <button class="add-credit-button" id="add-credit-psm">‚ûï Aggiungi Crediti</button>
        <button class="remove-credit-button" id="remove-credit-psm">‚ûñ Rimuovi Crediti</button>
    </div>

    <!-- Lista clienti -->
    <div id="client-list"></div>

    <script src="app.js"></script>

    <!-- Script per ricevere in tempo reale i codici RFID -->
    <script>
  const eventSource = new EventSource("https://pilates-app-backend.onrender.com/api/rfid");



    let latestRFID = null;

    eventSource.onmessage = function (event) {
        const scannedRfidElement = document.getElementById("scanned-rfid");
        const rfid = event.data.trim();

        console.log("üì° Codice RFID ricevuto:", rfid);

        // Ignora messaggio iniziale
       if (rfid === "Connesso al server RFID") {
    console.log("‚úÖ Connessione stabilita");
    return; // Non mostra nulla, oppure puoi mostrarlo altrove se vuoi
}


        // Salva l'ultimo codice ricevuto (pu√≤ servire per associare il cliente)
        latestRFID = rfid;

        // Mostra il codice RFID a schermo
        scannedRfidElement.textContent = `üîê Codice RFID: ${rfid}`;
        scannedRfidElement.style.color = "blue";

        // Evidenzia per 2 secondi
        scannedRfidElement.style.backgroundColor = "yellow";
        setTimeout(() => {
            scannedRfidElement.style.backgroundColor = "";
            scannedRfidElement.style.color = "black";
        }, 2000);
    };

    eventSource.onerror = function () {
        console.error("‚ùå Errore nella connessione SSE con /api/rfid");
        const scannedRfidElement = document.getElementById("scanned-rfid");
        scannedRfidElement.textContent = "‚ùå Disconnesso dal server RFID";
        scannedRfidElement.style.color = "red";
    };

    // Rendi disponibile il codice RFID anche ad altre funzioni
    window.getLatestRFID = function () {
        return latestRFID;
    };
    </script>
</body>
</html>
